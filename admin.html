<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel Administrativo ‚Ä¢ Luary Shop</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        body { background:#0b0b0b; color:#eee; font-family:'Inter', sans-serif; margin:0; }
        nav button.active { border-bottom:2px solid #caa85c; color:#caa85c; }
        section { display:none; min-height:300px; }
        section.active { display:block; }
        .card { background:#141414; border:1px solid #2a2a2a; border-radius:16px; padding:14px; }
        .btn { background:#222; border:1px solid #444; padding:8px 12px; border-radius:8px; font-size:11px; cursor:pointer; transition: 0.3s; }
        .btn-gold { background:#caa85c; color:#000; font-weight:700; padding:10px; border-radius:8px; cursor:pointer; text-transform: uppercase; font-size: 11px; text-align: center; }
        input, select { background:#111; border:1px solid #333; padding:8px; border-radius:8px; width:100%; margin-bottom:8px; color:#fff; outline:none; font-size: 12px; }
        label { font-[10px]; text-transform: uppercase; color: #666; font-weight: bold; margin-bottom: 4px; display: block; }
        
        /* Modal do Painel de Promo√ß√µes */
        #mainModal.active { display: flex; }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #caa85c; border-radius: 10px; }
    </style>
</head>
<body>

<header class="p-5 text-center text-xl font-bold bg-black border-b border-[#222] text-[#caa85c] tracking-widest uppercase">
   LUARY SHOP ‚Ä¢ ADMIN
</header>

<nav class="flex gap-2 p-2 bg-[#111] sticky top-0 z-50 overflow-x-auto">
    <button type="button" class="btn active" onclick="showTab('pedidos', this)">Pedidos</button>
    <button type="button" class="btn" onclick="showTab('produtos', this)">Produtos</button>
    <button type="button" class="btn" onclick="showTab('categorias', this)">Categorias</button>
    <button type="button" class="btn" onclick="showTab('promocoes', this)">Promo√ß√µes</button>
    <button type="button" class="btn" onclick="showTab('empresa', this)">Empresa</button>
</nav>

<main class="p-6 max-w-4xl mx-auto">
    <section id="pedidos" class="active">
        <div id="listaPedidos" class="grid gap-4"></div>
    </section>

    <section id="produtos">
        <div id="listaProdutos" class="grid gap-2"></div>
    </section>

    <section id="categorias">
        <div class="card mb-4">
            <input id="newCatName" placeholder="Nome da Categoria">
            <button class="btn-gold w-full" onclick="novaCategoria()">CADASTRAR</button>
        </div>
        <div id="listaCategorias" class="grid gap-2"></div>
    </section>

    <section id="promocoes">
        <div class="card text-center space-y-6 p-10">
            <h2 class="text-[#caa85c] font-black text-2xl uppercase tracking-tighter">Gest√£o de Ofertas</h2>
            <p class="text-gray-400 text-xs">Ative campanhas globais ou personalize descontos por categoria.</p>
            
            <div class="bg-black/40 p-6 rounded-2xl border border-white/5 inline-block w-full">
                <label class="mb-2">Status da Promo√ß√£o no Site</label>
                <button id="btnStatusPromo" onclick="togglePromoStatus()" class="px-10 py-3 rounded-xl font-black text-xs transition-all bg-red-900/20 text-red-500 border border-red-500/20">DESATIVADA</button>
            </div>

            <button class="btn-gold w-full py-5 text-sm" onclick="abrirPainelPromocoes()">
                üé® ABRIR EDITOR DE CAMPANHAS POR CATEGORIA
            </button>
        </div>
    </section>

    <section id="empresa">
        <div class="card space-y-3">
            <h2 class="text-[#caa85c] font-bold uppercase text-sm">Configura√ß√µes</h2>
            <input id="empNome" placeholder="Nome da Empresa">
            <input id="empWhats" placeholder="WhatsApp">
            <button class="btn-gold w-full" onclick="salvarEmpresa()">SALVAR</button>
        </div>
    </section>
</main>

<div id="mainModal" class="fixed inset-0 bg-black/95 z-[200] hidden items-center justify-center p-4">
    <div class="bg-[#141414] border border-[#2a2a2a] w-full max-w-2xl rounded-3xl overflow-hidden flex flex-col max-h-[90vh]">
        <div class="p-5 border-b border-[#222] flex justify-between items-center bg-black/50">
            <h3 class="text-[#caa85c] font-black uppercase text-sm tracking-widest">Editor de Campanhas</h3>
            <button onclick="fecharModal()" class="text-gray-500 text-3xl">&times;</button>
        </div>
        <div id="modalBody" class="p-6 overflow-y-auto custom-scroll space-y-6">
            </div>
        <div class="p-5 border-t border-[#222] bg-black/50">
            <button id="modalSaveBtn" class="btn-gold w-full py-4">SALVAR TODAS AS ALTERA√á√ïES</button>
        </div>
    </div>
</div>

<script>
// Configura√ß√£o Firebase Luary
const firebaseConfig = {
    apiKey: "AIzaSyD62Yef2ggoAFSc-qKPlBTaRPRn20D91ug",
    databaseURL: "https://luary-shop-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function showTab(id, btn) {
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    btn.classList.add('active');
    if(id === 'pedidos') carregarPedidos();
    if(id === 'produtos') carregarProdutos();
}

// --- FUN√á√ÉO DO PAINEL DE PROMO√á√ïES COMPLETO ---
async function abrirPainelPromocoes() {
    try {
        const [snapCats, snapStatus] = await Promise.all([
            db.ref('categories').once('value'),
            db.ref('settings/promocao/ativa').once('value')
        ]);

        let html = '';
        snapCats.forEach(cat => {
            const c = cat.val();
            html += `
            <div class="card bg-black/60 border-white/5 p-5">
                <div class="flex justify-between items-center mb-4 border-b border-white/5 pb-2">
                    <span class="text-[#caa85c] font-black uppercase text-xs">${c.name}</span>
                    <span class="text-[10px] bg-[#caa85c]/10 text-[#caa85c] px-2 py-1 rounded">ID: ${cat.key}</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label>Campanha (Nome interno)</label>
                        <input id="p_name_${cat.key}" value="${c.promoName || ''}" placeholder="Ex: Black Friday">
                    </div>
                    <div>
                        <label>Texto da Tag (No site)</label>
                        <input id="p_tag_${cat.key}" value="${c.promoTag || ''}" placeholder="Ex: 20% OFF">
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-2 mt-2">
                    <div>
                        <label>% Desc.</label>
                        <input id="p_pct_${cat.key}" type="number" value="${c.promoPct || 0}">
                    </div>
                    <div>
                        <label>Cor Fundo</label>
                        <input id="p_color_${cat.key}" type="color" value="${c.promoColor || '#caa85c'}" class="h-10">
                    </div>
                    <div>
                        <label>Cor Texto</label>
                        <input id="p_tcolor_${cat.key}" type="color" value="${c.promoTextColor || '#ffffff'}" class="h-10">
                    </div>
                </div>
            </div>`;
        });

        document.getElementById('modalBody').innerHTML = html;
        document.getElementById('mainModal').classList.add('active');

        document.getElementById('modalSaveBtn').onclick = () => {
            const updates = {};
            snapCats.forEach(cat => {
                updates[`categories/${cat.key}/promoPct`] = Number(document.getElementById(`p_pct_${cat.key}`).value) || 0;
                updates[`categories/${cat.key}/promoName`] = document.getElementById(`p_name_${cat.key}`).value;
                updates[`categories/${cat.key}/promoTag`] = document.getElementById(`p_tag_${cat.key}`).value;
                updates[`categories/${cat.key}/promoColor`] = document.getElementById(`p_color_${cat.key}`).value;
                updates[`categories/${cat.key}/promoTextColor`] = document.getElementById(`p_tcolor_${cat.key}`).value;
            });
            db.ref().update(updates).then(() => {
                alert("Configura√ß√µes de promo√ß√£o salvas!");
                fecharModal();
            });
        };
    } catch (e) { console.error(e); }
}

function togglePromoStatus() {
    const btn = document.getElementById('btnStatusPromo');
    const ativa = btn.innerText === 'ATIVA';
    const novoStatus = !ativa;
    
    db.ref('settings/promocao/ativa').set(novoStatus).then(() => {
        btn.innerText = novoStatus ? 'ATIVA' : 'DESATIVADA';
        btn.className = `px-10 py-3 rounded-xl font-black text-xs transition-all ${novoStatus ? 'bg-green-900/20 text-green-500 border border-green-500/20' : 'bg-red-900/20 text-red-500 border border-red-500/20'}`;
    });
}

function fecharModal() { document.getElementById('mainModal').classList.remove('active'); }

// Fun√ß√µes Auxiliares mantidas para funcionamento dos outros menus
function carregarPedidos() {
    db.ref('orders').on('value', s => {
        const l = document.getElementById('listaPedidos'); l.innerHTML = '';
        s.forEach(p => {
            const v = p.val();
            l.innerHTML += `<div class="card flex justify-between items-center border-l-4 border-[#caa85c]">
                <div><b class="text-[#caa85c] text-xs uppercase">${v.cliente?.nome}</b><br><small class="text-gray-500">${v.data}</small></div>
                <button class="btn" onclick="alert('Use o editor completo do arquivo anterior para editar este pedido.')">EDITAR</button>
            </div>`;
        });
    });
}

window.onload = () => {
    carregarPedidos();
    // Sync inicial do status da promo
    db.ref('settings/promocao/ativa').on('value', s => {
        const v = s.val();
        const btn = document.getElementById('btnStatusPromo');
        btn.innerText = v ? 'ATIVA' : 'DESATIVADA';
        btn.className = `px-10 py-3 rounded-xl font-black text-xs transition-all ${v ? 'bg-green-900/20 text-green-500 border border-green-500/20' : 'bg-red-900/20 text-red-500 border border-red-500/20'}`;
    });
};
</script>
</body>
</html>
