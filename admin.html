<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel Administrativo â€¢ Luary Shop</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { background:#0b0b0b; color:#eee; font-family:'Inter', sans-serif; margin:0; }
        nav button.active { border-bottom:2px solid #d4af37; color:#d4af37; }
        section { display:none; min-height:300px; }
        section.active { display:block; }
        .card { background:#141414; border:1px solid #2a2a2a; border-radius:16px; padding:14px; }
        .btn { background:#222; border:1px solid #444; padding:8px 12px; border-radius:8px; font-size:11px; cursor:pointer; transition: 0.3s; }
        .btn:hover { background:#333; }
        .btn-gold { background:#d4af37; color:#000; font-weight:700; padding:10px; border-radius:8px; cursor:pointer; }
        input, select { background:#111; border:1px solid #333; padding:8px; border-radius:8px; width:100%; margin-bottom:8px; color:#fff; outline:none; }
        
        /* Estilos de ImpressÃ£o baseados no original */
        @media print {
            body * { visibility: hidden; }
            #print-area, #print-area * { visibility: visible; }
            #print-area { position: absolute; left: 0; top: 0; width: 100%; display: block; background: #fff; color: #000; }
        }
    </style>
</head>
<body>

<header class="p-5 text-center text-xl font-bold bg-black border-b border-[#222] text-[#d4af37] tracking-widest uppercase">
    Luary Shop â€¢ GestÃ£o Administrativa [cite: 1]
</header>

<nav class="flex gap-2 p-2 bg-[#111] sticky top-0 z-50 overflow-x-auto">
    <button type="button" class="btn active" onclick="showTab('pedidos', this)">Pedidos</button>
    <button type="button" class="btn" onclick="showTab('produtos', this)">Produtos</button>
    <button type="button" class="btn" onclick="showTab('categorias', this)">Categorias</button>
    <button type="button" class="btn" onclick="showTab('promocoes', this)">PromoÃ§Ãµes</button>
    <button type="button" class="btn" onclick="showTab('empresa', this)">Empresa</button>
</nav>

<main class="p-6 max-w-4xl mx-auto">
    <section id="pedidos" class="active">
        <div id="listaPedidos" class="grid gap-4"></div>
    </section>

    <section id="produtos">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-[#d4af37] font-bold uppercase text-sm">Lista de Produtos</h2>
        </div>
        <div id="listaProdutos" class="grid gap-2"></div>
    </section>

    <section id="categorias">
        <div class="card mb-4">
            <input id="newCatName" placeholder="Nome da Nova Categoria">
            <button class="btn-gold w-full" onclick="novaCategoria()">+ CADASTRAR CATEGORIA</button>
        </div>
        <div id="listaCategorias" class="grid gap-2"></div>
    </section>

    <section id="promocoes">
        <div class="card text-center">
            <h2 class="text-[#d4af37] font-bold uppercase text-sm mb-4">Painel de Ofertas</h2>
            <button class="btn-gold w-full py-4" onclick="abrirPainelPromocoes()">ðŸŽ¨ Configurar Descontos por Categoria</button>
        </div>
    </section>

    <section id="empresa">
        <div class="card space-y-3">
            <h2 class="text-[#d4af37] font-bold uppercase text-sm">ConfiguraÃ§Ã£o da Loja</h2>
            <input id="empNome" placeholder="Nome da Empresa">
            <input id="empWhats" placeholder="WhatsApp da Loja">
            <button class="btn-gold w-full" onclick="salvarEmpresa()">GUARDAR ALTERAÃ‡Ã•ES</button>
        </div>
    </section>
</main>

<div id="mainModal" class="fixed inset-0 bg-black/90 z-[100] hidden items-center justify-center p-4">
    <div class="bg-[#141414] border border-[#2a2a2a] w-full max-w-lg rounded-2xl overflow-hidden shadow-2xl">
        <div class="p-4 border-b border-[#222] flex justify-between items-center">
            <h3 id="modalTitle" class="text-[#d4af37] font-bold uppercase text-sm">TÃ­tulo</h3>
            <button onclick="fecharModal()" class="text-gray-500 hover:text-white text-2xl">&times;</button>
        </div>
        <div id="modalBody" class="p-6 max-h-[70vh] overflow-y-auto"></div>
        <div class="p-4 border-t border-[#222] flex gap-3">
            <button id="modalSaveBtn" class="flex-1 btn-gold py-3 text-xs uppercase font-bold">Salvar</button>
        </div>
    </div>
</div>

<div id="editorPedido" class="hidden fixed inset-0 bg-black/95 flex items-center justify-center z-[100] p-4">
  <div class="bg-[#111] w-full max-w-4xl rounded-2xl p-5 overflow-auto max-h-[95vh] border border-[#333]">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-[#d4af37] font-bold text-lg uppercase">Editar Pedido</h2>
        <div id="totalPreview" class="text-[#d4af37] font-bold text-xl">R$ 0,00</div>
    </div>
    <div class="grid md:grid-cols-2 gap-4">
        <div class="card">
            <h3 class="text-[10px] text-gray-400 uppercase font-bold mb-2">Cliente</h3>
            <input id="edClienteNome" placeholder="Nome">
            <input id="edClienteTel" placeholder="WhatsApp">
        </div>
        <div class="card">
            <h3 class="text-[10px] text-gray-400 uppercase font-bold mb-2">Entrega</h3>
            <input id="edNomeEntrega" placeholder="DestinatÃ¡rio">
            <input id="edRua" placeholder="Rua/NÃºmero">
            <div class="grid grid-cols-2 gap-2"><input id="edBairro" placeholder="Bairro"><input id="edCidade" placeholder="Cidade"></div>
        </div>
    </div>
    <div id="edItens" class="mt-4 space-y-2"></div>
    <div class="grid grid-cols-3 gap-3 mt-4">
        <input id="edDescPromo" type="number" placeholder="Desc. Promo">
        <input id="edDescPix" type="number" placeholder="Desc. PIX">
        <input id="edFrete" type="number" placeholder="Frete">
    </div>
    <div class="flex gap-2 mt-6">
        <button class="btn flex-1 text-red-500" onclick="fecharEditorPedido()">CANCELAR</button>
        <button class="btn-gold flex-1" onclick="salvarPedidoEditado()">SALVAR ALTERAÃ‡Ã•ES</button>
    </div>
  </div>
</div>

<div id="print-area"></div>

<script>
// Use suas credenciais do Firebase aqui
const firebaseConfig = {
    apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
    databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let pedidoEditando = null;
const fMoeda = v => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v || 0);

function showTab(id, btn) {
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    btn.classList.add('active');
    if(id === 'pedidos') carregarPedidos();
    if(id === 'produtos') carregarProdutos();
}

// --- FUNÃ‡Ã•ES DE PEDIDOS (COM EDITAR/EXCLUIR/DUPLICAR) ---
function carregarPedidos() {
    db.ref('orders').on('value', s => {
        const lista = document.getElementById('listaPedidos');
        lista.innerHTML = '';
        s.forEach(ped => {
            const p = ped.val();
            lista.innerHTML += `
            <div class="card border-l-4 border-[#d4af37] flex justify-between items-center">
                <div>
                    <b class="text-[#d4af37] uppercase text-sm">${p.cliente?.nome || 'Cliente'}</b><br>
                    <small class="text-gray-500">${p.data || ''}</small>
                </div>
                <div class="flex gap-2">
                    <button class="btn bg-blue-900" onclick="duplicarPedido('${ped.key}')" title="Duplicar">ðŸ“‘</button>
                    <button class="btn" onclick="abrirEditorPedido('${ped.key}')">EDITAR</button>
                    <button class="btn bg-red-900" onclick="excluirPedido('${ped.key}')">ðŸ—‘</button>
                </div>
            </div>`;
        });
    });
}

// --- FUNÃ‡Ã•ES DE PRODUTOS (RESTAURADA) ---
function carregarProdutos() {
    const lista = document.getElementById('listaProdutos');
    lista.innerHTML = '<p class="text-center p-4">Carregando...</p>';
    db.ref('categories').once('value', sCats => {
        db.ref('products').once('value', sProds => {
            lista.innerHTML = '';
            sCats.forEach(cat => {
                let htmlP = '';
                sProds.forEach(p => {
                    const prod = p.val();
                    if(prod.category === cat.key) {
                        htmlP += `
                        <div class="card flex justify-between items-center py-2 bg-[#0d0d0d] mb-1">
                            <div class="flex items-center gap-3">
                                <img src="${prod.image || ''}" class="w-8 h-8 object-cover rounded">
                                <span class="text-[11px]"><b class="text-[#d4af37]">[${prod.sku || '---'}]</b> ${prod.name}</span>
                            </div>
                            <button class="text-xs" onclick="editarProduto('${p.key}')">âœŽ</button>
                        </div>`;
                    }
                });
                if(htmlP) lista.innerHTML += `<div class="mb-4"><b class="text-[10px] text-[#d4af37] uppercase">${cat.val().name}</b>${htmlP}</div>`;
            });
        });
    });
}

// FunÃ§Ãµes de suporte (IDÃŠNTICAS AO SEU ADM.TXT ORIGINAL)
function fecharModal() { document.getElementById('mainModal').classList.remove('active'); }
function fecharEditorPedido() { document.getElementById('editorPedido').classList.add('hidden'); }
function excluirPedido(id) { if(confirm("Excluir pedido permanentemente?")) db.ref('orders/'+id).remove(); }
function duplicarPedido(id) {
    db.ref('orders/'+id).once('value', s => {
        const novo = s.val();
        novo.data = new Date().toLocaleString();
        db.ref('orders').push(novo).then(() => alert("Pedido duplicado!"));
    });
}

// InicializaÃ§Ã£o
window.onload = () => carregarPedidos();
</script>
</body>
</html>
